(function(global,factory){if(typeof define==='function'&&define.amd){define(['react','prop-types','active-resource','underscore'],factory)}else if(typeof exports!=='undefined'){factory(require('react'),require('prop-types'),require('active-resource'),require('underscore'))}else{var mod={exports:{}};factory(global.react,global.propTypes,global.activeResource,global.underscore);global.mitragyna=mod.exports}})(this,function(_react,_propTypes,_activeResource,_underscore){'use strict';var _react2=_interopRequireDefault(_react);var _propTypes2=_interopRequireDefault(_propTypes);var _activeResource2=_interopRequireDefault(_activeResource);var _underscore2=_interopRequireDefault(_underscore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _class,_temp,_class2,_temp2,_class3,_temp3,_class4,_temp4;Mitragyna.Collection=(_temp=_class=function(_React$PureComponent){_inherits(Collection,_React$PureComponent);// link to global state by enabling afterLoad, afterAdd, afterRemove, afterUpdate callbacks that can call
// an action linked to dispatch
function Collection(){_classCallCheck(this,Collection);var _this=_possibleConstructorReturn(this,(Collection.__proto__||Object.getPrototypeOf(Collection)).call(this));_this.state={loading:true,target:Immutable.List()};_underscore2.default.bindAll(_this,'buildOnTarget','replaceOnTarget','removeFromTarget');return _this}_createClass(Collection,[{key:'componentDidMount',value:function componentDidMount(){this.setTarget(this.props)}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){this.setTarget(nextProps)}},{key:'setTarget',value:function setTarget(props){var _this2=this;var subject=props.subject;var isRelationship=subject.isA(_activeResource2.default.prototype.Associations.prototype.CollectionProxy);var setLoadedTarget=function setLoadedTarget(target){return _this2.setState({loading:false,target:Immutable.List(target.toArray())})};if(isRelationship){if(subject.base.loaded()){setLoadedTarget(subject.base.target)}else{subject.load().then(setLoadedTarget)}}else if(!_underscore2.default.isUndefined(subject.all)){subject.all().then(setLoadedTarget)}}},{key:'buildOnTarget',value:function buildOnTarget(attributes){var subject=this.props.subject;var target=this.state.target;this.setState({target:target.push(subject.build(attributes))})}},{key:'replaceOnTarget',value:function replaceOnTarget(newItem,oldItem){var index=this.state.target.findIndex(function(i){return i==oldItem});return this.setState({target:this.state.target.set(index,newItem)})}},{key:'removeFromTarget',value:function removeFromTarget(item){var index=this.state.target.findIndex(function(i){return i.localId==item.localId});return this.setState({target:this.state.target.delete(index)})}},{key:'render',value:function render(){var _this3=this;var _props=this.props,blankComponent=_props.blankComponent,children=_props.children,className=_props.className,component=_props.component,inlineRows=_props.inlineRows,rowClassName=_props.rowClassName;var _state=this.state,loading=_state.loading,target=_state.target;return _react2.default.createElement('section',{className:className},loading?_react2.default.createElement('span',null,'Loading'):target.size>0?target.map(function(t){return _react2.default.createElement(Mitragyna.Resource,{subject:t,key:t.localId,component:component,className:rowClassName,inline:inlineRows,afterUpdate:_this3.replaceOnTarget},children)}):blankComponent!=null&&blankComponent())}}]);return Collection}(_react2.default.PureComponent),_class.propTypes={children:_propTypes2.default.oneOfType([_propTypes2.default.array,_propTypes2.default.node]),className:_propTypes2.default.string,blankComponent:_propTypes2.default.func,component:_propTypes2.default.func,inlineRows:_propTypes2.default.bool,rowClassName:_propTypes2.default.string,subject:_propTypes2.default.oneOfType([_propTypes2.default.object,_propTypes2.default.func]).isRequired},_class.defaultProps={inlineRows:false},_temp);Mitragyna.ErrorsFor=(_temp2=_class2=function(_React$PureComponent2){_inherits(ErrorsFor,_React$PureComponent2);function ErrorsFor(){_classCallCheck(this,ErrorsFor);return _possibleConstructorReturn(this,(ErrorsFor.__proto__||Object.getPrototypeOf(ErrorsFor)).apply(this,arguments))}_createClass(ErrorsFor,[{key:'render',value:function render(){var _props2=this.props,attribute=_props2.attribute,resource=_props2.resource;if(_underscore2.default.size(resource.errors().forField(attribute))<1){return null}return _react2.default.createElement('p',{className:'dark-red f6 mt2 mb0'},_underscore2.default.map(resource.errors().forField(attribute),function(message,code){return _react2.default.createElement('span',{key:code,className:'db'},message)}))}}]);return ErrorsFor}(_react2.default.PureComponent),_class2.propTypes={attribute:_propTypes2.default.string,resource:_propTypes2.default.object.isRequired},_temp2);Mitragyna.Input=(_temp3=_class3=function(_React$PureComponent3){_inherits(Input,_React$PureComponent3);function Input(){_classCallCheck(this,Input);var _this5=_possibleConstructorReturn(this,(Input.__proto__||Object.getPrototypeOf(Input)).call(this));_underscore2.default.bindAll(_this5,'createInputElement','createSelectElement','handleChange','handleUpdate');return _this5}_createClass(Input,[{key:'componentWillMount',value:function componentWillMount(){var _props3=this.props,name=_props3.name,type=_props3.type;var resource=this.context.resource;// Set initial value to that of the resources
this.setState({value:type=='select'?this.selectValueFor(resource[name]()):resource[name]})}},{key:'render',value:function render(){var _props4=this.props,name=_props4.name,type=_props4.type;var _context=this.context,inline=_context.inline,resource=_context.resource;var input=type==='select'?this.createSelectElement():this.createInputElement();return _react2.default.createElement(inline?'span':'div',{},[input,_react2.default.createElement(Mitragyna.ErrorsFor,{attribute:name,resource:resource,key:'errors'})])}},{key:'createInputElement',value:function createInputElement(){var name=this.props.name;return _react2.default.createElement('input',_extends({},this.props,{key:name,onBlur:this.handleUpdate,onChange:this.handleChange,value:this.state.value}))}},{key:'selectValueFor',value:function selectValueFor(resource){return resource&&resource.id||''}},{key:'createSelectElement',value:function createSelectElement(){var _props5=this.props,includeBlank=_props5.includeBlank,name=_props5.name,options=_props5.options,optionsLabelKey=_props5.optionsLabelKey;var selectOptions=null;if(options.isEmpty()){throw'Input type="select" must have options'}else{selectOptions=options.map(function(o){return _react2.default.createElement('option',{key:o.localId,value:o.id},o[optionsLabelKey])});if(includeBlank){selectOptions=selectOptions.unshift(_react2.default.createElement('option',{key:-1,value:''}))}}var selectProps=_underscore2.default.omit(this.props,_underscore2.default.keys(Input.propTypes));return _react2.default.createElement('select',_extends({},selectProps,{key:name,onBlur:this.handleUpdate,onChange:this.handleChange,value:this.state.value}),selectOptions)}},{key:'handleChange',value:function handleChange(e){e.persist();this.setState({value:e.target.value})}},{key:'handleUpdate',value:function handleUpdate(e){e.persist();var _context2=this.context,afterUpdate=_context2.afterUpdate,resource=_context2.resource;var _props6=this.props,name=_props6.name,type=_props6.type,options=_props6.options;var value=e.target.value;if(type==='select'){value=options.find(function(o){return o.id===value})}afterUpdate(resource.assignAttributes(_defineProperty({},name,value)))}}]);return Input}(_react2.default.PureComponent),_class3.contextTypes={afterUpdate:_propTypes2.default.func,inline:_propTypes2.default.bool,resource:_propTypes2.default.object},_class3.propTypes={includeBlank:_propTypes2.default.bool,options:_propTypes2.default.array,optionsLabelKey:_propTypes2.default.string},_temp3);Mitragyna.Resource=(_temp4=_class4=function(_React$PureComponent4){_inherits(Resource,_React$PureComponent4);function Resource(props,context){_classCallCheck(this,Resource);var _this6=_possibleConstructorReturn(this,(Resource.__proto__||Object.getPrototypeOf(Resource)).call(this));_underscore2.default.bindAll(_this6,'afterUpdate','updateRoot');return _this6}_createClass(Resource,[{key:'componentWillMount',value:function componentWillMount(){var root=this.context.root;var _props7=this.props,reflection=_props7.reflection,subject=_props7.subject;if(reflection){var reflectionInstance=root.reflectOnAssociation(reflection);if(_underscore2.default.isUndefined(reflectionInstance))throw'Reflection '+reflection+' not found.';var inverseReflection=reflectionInstance.inverseOf();if(_underscore2.default.isUndefined(inverseReflection))throw'Reflection '+reflection+' must have inverse.';this.setState({inverseReflection:inverseReflection,reflection:reflectionInstance})}else{this.setState({resource:subject})}}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){this.setState({resource:nextProps.subject})}},{key:'afterUpdate',value:function afterUpdate(newResource){var updateRoot=this.context.updateRoot;var inverseReflection=this.state.inverseReflection;if(inverseReflection){updateRoot(newResource.association(inverseReflection.name).target)}else{this.updateRoot(newResource)}}},{key:'getChildContext',value:function getChildContext(){var root=this.context.root;var inline=this.props.inline;var resource=this.state.resource;var childContext={afterUpdate:this.afterUpdate,inline:inline,isNestedResource:true,root:root||this,resource:resource,updateRoot:this.updateRoot};return childContext}},{key:'render',value:function render(){var isNestedResource=this.context.isNestedResource;var _props8=this.props,children=_props8.children,className=_props8.className,component=_props8.component;var resource=this.state.resource;var body=null;if(component){body=_react2.default.createElement(component,{subject:resource})}else{body=children}if(!isNestedResource){body=_react2.default.createElement('form',null,body)}return _react2.default.createElement('section',{className:className},body)}},{key:'updateRoot',value:function updateRoot(newRoot){var _this7=this;var fromSave=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var afterUpdate=this.context.afterUpdate;var resource=this.props.resource;this.setState({resource:newRoot});if(!_underscore2.default.isUndefined(afterUpdate))afterUpdate(newRoot,resource);if(!fromSave){newRoot.save(function(root){return _this7.updateRoot(root,true)})}}}]);return Resource}(_react2.default.PureComponent),_class4.propTypes={afterUpdate:_propTypes2.default.func,children:_propTypes2.default.oneOfType([_propTypes2.default.array,_propTypes2.default.node]),className:_propTypes2.default.string,component:_propTypes2.default.func,inline:_propTypes2.default.bool,reflection:_propTypes2.default.string,subject:_propTypes2.default.object.isRequired},_class4.contextTypes={isNestedResource:_propTypes2.default.bool,resourceRoot:_propTypes2.default.object,updateRoot:_propTypes2.default.func},_class4.childContextTypes={afterUpdate:_propTypes2.default.func,inline:_propTypes2.default.bool,isNestedResource:_propTypes2.default.bool,resource:_propTypes2.default.object,root:_propTypes2.default.object,updateRoot:_propTypes2.default.func},_class4.defaultProps={inline:false},_temp4)});
//# sourceMappingURL=mitragyna.min.js.map
