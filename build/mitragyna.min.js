(function(global,factory){if(typeof define==='function'&&define.amd){define(['exports','react','prop-types','active-resource','underscore'],factory)}else if(typeof exports!=='undefined'){factory(exports,require('react'),require('prop-types'),require('active-resource'),require('underscore'))}else{var mod={exports:{}};factory(mod.exports,global.react,global.propTypes,global.activeResource,global.underscore);global.Collection=mod.exports}})(this,function(exports,_react,_propTypes,_activeResource,_underscore){'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.Collection=undefined;var _react2=_interopRequireDefault(_react);var _propTypes2=_interopRequireDefault(_propTypes);var _activeResource2=_interopRequireDefault(_activeResource);var _underscore2=_interopRequireDefault(_underscore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Collection=exports.Collection=function(_React$PureComponent){_inherits(Collection,_React$PureComponent);// link to global state by enabling afterLoad, afterAdd, afterRemove, afterUpdate callbacks that can call
// an action linked to dispatch
function Collection(){_classCallCheck(this,Collection);var _this=_possibleConstructorReturn(this,(Collection.__proto__||Object.getPrototypeOf(Collection)).call(this));_this.state={loading:true,target:Immutable.List()};_underscore2.default.bindAll(_this,'buildOnTarget','replaceOnTarget','removeFromTarget');return _this}_createClass(Collection,[{key:'componentDidMount',value:function componentDidMount(){this.setTarget(this.props)}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){this.setTarget(nextProps)}},{key:'setTarget',value:function setTarget(props){var _this2=this;var subject=props.subject;var isRelationship=subject.isA(_activeResource2.default.prototype.Associations.prototype.CollectionProxy);var setLoadedTarget=function setLoadedTarget(target){return _this2.setState({loading:false,target:Immutable.List(target.toArray())})};if(isRelationship){if(subject.base.loaded()){setLoadedTarget(subject.base.target)}else{subject.load().then(setLoadedTarget)}}else if(!_underscore2.default.isUndefined(subject.all)){subject.all().then(setLoadedTarget)}}},{key:'buildOnTarget',value:function buildOnTarget(attributes){var subject=this.props.subject;var target=this.state.target;this.setState({target:target.push(subject.build(attributes))})}},{key:'replaceOnTarget',value:function replaceOnTarget(newItem,oldItem){var index=this.state.target.findIndex(function(i){return i==oldItem});return this.setState({target:this.state.target.set(index,newItem)})}},{key:'removeFromTarget',value:function removeFromTarget(item){var index=this.state.target.findIndex(function(i){return i.localId==item.localId});return this.setState({target:this.state.target.delete(index)})}},{key:'render',value:function render(){var _this3=this;var _props=this.props,blankComponent=_props.blankComponent,children=_props.children,className=_props.className,component=_props.component,inlineRows=_props.inlineRows,rowClassName=_props.rowClassName;var _state=this.state,loading=_state.loading,target=_state.target;return _react2.default.createElement('section',{className:className},loading?_react2.default.createElement('span',null,'Loading'):target.size>0?target.map(function(t){return _react2.default.createElement(Mitragyna.Resource,{subject:t,key:t.localId,component:component,className:rowClassName,inline:inlineRows,afterUpdate:_this3.replaceOnTarget},children)}):blankComponent!=null&&blankComponent())}}]);return Collection}(_react2.default.PureComponent);Collection.propTypes={children:_propTypes2.default.oneOfType([_propTypes2.default.array,_propTypes2.default.node]),className:_propTypes2.default.string,blankComponent:_propTypes2.default.func,component:_propTypes2.default.func,inlineRows:_propTypes2.default.bool,rowClassName:_propTypes2.default.string,subject:_propTypes2.default.oneOfType([_propTypes2.default.object,_propTypes2.default.func]).isRequired};Collection.defaultProps={inlineRows:false}});
//# sourceMappingURL=mitragyna.min.js.map
