{"version":3,"sources":["../src/Collection.jsx"],"names":["Collection","state","loading","target","Immutable","List","bindAll","setTarget","props","nextProps","subject","isRelationship","isA","prototype","Associations","CollectionProxy","setLoadedTarget","setState","toArray","base","loaded","load","then","isUndefined","all","attributes","push","build","newItem","oldItem","index","findIndex","i","set","item","localId","delete","blankComponent","children","className","component","inlineRows","rowClassName","size","map","t","replaceOnTarget","PureComponent","propTypes","oneOfType","array","node","string","func","bool","object","isRequired","defaultProps"],"mappings":"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","file":"mitragyna.min.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport ActiveResource from 'active-resource';\nimport _ from 'underscore';\n\nexport class Collection extends React.PureComponent {\n  static propTypes = {\n    children: PropTypes.oneOfType([\n      PropTypes.array,\n      PropTypes.node,\n    ]),\n    className: PropTypes.string,\n    blankComponent: PropTypes.func,\n    component: PropTypes.func,\n    inlineRows: PropTypes.bool,\n    rowClassName: PropTypes.string,\n    subject: PropTypes.oneOfType([\n      PropTypes.object,\n      PropTypes.func,\n    ]).isRequired,\n  };\n\n  static defaultProps = {\n    inlineRows: false\n  };\n\n  // link to global state by enabling afterLoad, afterAdd, afterRemove, afterUpdate callbacks that can call\n  // an action linked to dispatch\n\n  constructor() {\n    super();\n\n    this.state = {\n      loading: true,\n      target: Immutable.List()\n    };\n\n    _.bindAll(this,\n      'buildOnTarget',\n      'replaceOnTarget',\n      'removeFromTarget',\n    );\n  }\n\n  componentDidMount() {\n    this.setTarget(this.props);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.setTarget(nextProps);\n  }\n\n  setTarget(props) {\n    const { subject } = props;\n\n    let isRelationship = subject.isA(ActiveResource.prototype.Associations.prototype.CollectionProxy);\n\n    let setLoadedTarget = (target) => this.setState({ loading: false, target: Immutable.List(target.toArray()) });\n\n    if(isRelationship) {\n      if(subject.base.loaded()) {\n        setLoadedTarget(subject.base.target)\n      } else {\n        subject.load()\n        .then(setLoadedTarget)\n      }\n    } else if(!_.isUndefined(subject.all)) {\n      subject.all()\n      .then(setLoadedTarget)\n    }\n  }\n\n  buildOnTarget(attributes) {\n    const { subject } = this.props;\n    const { target } = this.state;\n\n    this.setState({ target: target.push(subject.build(attributes)) });\n  }\n\n  replaceOnTarget(newItem, oldItem) {\n    let index = this.state.target.findIndex((i) => i == oldItem);\n    return this.setState({ target: this.state.target.set(index, newItem) });\n  }\n\n  removeFromTarget(item) {\n    let index = this.state.target.findIndex((i) => i.localId == item.localId);\n    return this.setState({ target: this.state.target.delete(index) });\n  }\n\n  render() {\n    const { blankComponent, children, className, component, inlineRows, rowClassName } = this.props;\n    const { loading, target } = this.state;\n\n    return (\n      <section className={ className }>\n        { loading ? (\n          <span>Loading</span>\n        ) : (\n          target.size > 0 ? (\n            target.map((t) =>\n              <Mitragyna.Resource subject={ t } key={ t.localId } component= { component }\n                        className={ rowClassName } inline={ inlineRows }\n                        afterUpdate={ this.replaceOnTarget }>\n                { children }\n              </Mitragyna.Resource>\n            )\n          ) : (blankComponent != null &&\n            blankComponent()\n          )\n        )}\n      </section>\n    );\n  }\n}\n"]}